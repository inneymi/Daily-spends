<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Spends</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #111827;
            color: #f9fafb;
            min-height: 100vh;
            padding: 16px;
        }

        .container {
            max-width: 320px;
            margin: 0 auto;
            background: #1f2937;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .title-section {
            flex: 1;
        }

        .title {
            font-size: 18px;
            font-weight: bold;
            color: #f9fafb;
            margin-bottom: 2px;
        }

        .subtitle {
            font-size: 11px;
            color: #9ca3af;
            line-height: 1.3;
        }

        .total {
            background: #059669;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 12px;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            gap: 8px;
        }

        .nav-btn {
            background: #374151;
            border: none;
            color: #d1d5db;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .month-title {
            font-size: 16px;
            font-weight: bold;
            color: #f9fafb;
            text-align: center;
            flex: 1;
        }

        .calendar {
            background: #374151;
            border-radius: 12px;
            padding: 12px;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            margin-bottom: 8px;
        }

        .weekday {
            text-align: center;
            font-weight: 600;
            color: #9ca3af;
            font-size: 10px;
            padding: 4px 0;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .day {
            aspect-ratio: 1;
            border: 2px solid #4b5563;
            background: #4b5563;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            min-height: 36px;
            padding: 2px;
        }

        .day:hover {
            border-color: #6b7280;
            background: #6b7280;
        }

        .day.today {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .day.has-spending {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .day-number {
            font-weight: 600;
            font-size: 11px;
            line-height: 1;
            color: #f9fafb;
        }

        .day-amount {
            font-size: 7px;
            font-weight: 600;
            margin-top: 1px;
            color: #34d399;
            line-height: 1;
            text-align: center;
        }

        .plus-icon {
            font-size: 8px;
            color: #6b7280;
            margin-top: 1px;
        }

        .empty-day {
            border: none;
            background: none;
            cursor: default;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1f2937;
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 280px;
            border: 1px solid #374151;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 16px;
            font-weight: bold;
            color: #f9fafb;
            margin-bottom: 8px;
        }

        .current-total {
            background: #059669;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .input-section {
            margin-bottom: 16px;
        }

        .amount-input {
            width: 100%;
            padding: 14px;
            background: #374151;
            border: 2px solid #4b5563;
            border-radius: 8px;
            color: #f9fafb;
            font-size: 16px;
            text-align: center;
            outline: none;
            transition: border-color 0.2s;
            margin-bottom: 8px;
        }

        .amount-input:focus {
            border-color: #3b82f6;
        }

        .amount-input::placeholder {
            color: #6b7280;
        }

        .modal-buttons {
            display: flex;
            gap: 8px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-add {
            background: #3b82f6;
            color: white;
        }

        .btn-cancel {
            background: #6b7280;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title-section">
                <div class="title">Daily Spends</div>
                <div class="subtitle">Click any day to track spending</div>
            </div>
            <div class="total" id="monthTotal">Total: £0.00</div>
        </div>

        <!-- Navigation -->
        <div class="nav">
            <button class="nav-btn" id="prevBtn">‹ Prev</button>
            <div class="month-title" id="monthTitle">July 2025</div>
            <button class="nav-btn" id="nextBtn">Next ›</button>
        </div>

        <!-- Calendar -->
        <div class="calendar">
            <div class="weekdays">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>
            <div class="days" id="daysGrid">
                <!-- Days will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalDate">July 6</div>
                <div class="current-total" id="currentTotal">Total: £0.00</div>
            </div>
            <div class="input-section">
                <input type="number" 
                       step="0.01" 
                       class="amount-input" 
                       id="amountInput" 
                       placeholder="Amount to add (£)">
                <input type="text" 
                       class="amount-input" 
                       id="notesInput" 
                       placeholder="Notes (optional)"
                       style="font-size: 14px; text-align: left;">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn btn-add" id="addBtn">Add</button>
                <button class="modal-btn btn-cancel" id="cancelBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        console.log('Script starting...');

        // Global variables
        var spendingData = {};
        var currentMonth = 6; // July = 6 (0-based)
        var currentYear = 2025;
        var selectedDay = null;

        var months = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        console.log('Variables initialized');

        // Load data from localStorage
        function loadData() {
            try {
                var saved = localStorage.getItem('spendingData');
                if (saved) {
                    spendingData = JSON.parse(saved);
                    console.log('Data loaded:', spendingData);
                }
            } catch (e) {
                console.log('Using memory storage');
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('spendingData', JSON.stringify(spendingData));
                console.log('Data saved');
            } catch (e) {
                console.log('Using memory storage');
            }
        }

        // Get date key
        function getDateKey(day) {
            return currentYear + '-' + currentMonth + '-' + day;
        }

        // Get total for a day
        function getDayTotal(day) {
            var dateKey = getDateKey(day);
            var data = spendingData[dateKey];
            if (!data) return 0;
            
            if (typeof data === 'number') return data;
            if (data.amount) return data.amount;
            if (data.transactions) {
                var total = 0;
                for (var i = 0; i < data.transactions.length; i++) {
                    total += data.transactions[i].amount || 0;
                }
                return total;
            }
            return 0;
        }

        // Get month total
        function getMonthTotal() {
            var total = 0;
            for (var day = 1; day <= 31; day++) {
                total += getDayTotal(day);
            }
            return total;
        }

        // Update display
        function updateDisplay() {
            console.log('Updating display...');
            document.getElementById('monthTitle').textContent = 
                months[currentMonth] + ' ' + currentYear;
            document.getElementById('monthTotal').textContent = 
                'Total: £' + getMonthTotal().toFixed(2);
            console.log('Display updated');
        }

        // Build calendar
        function buildCalendar() {
            console.log('Building calendar...');
            
            var grid = document.getElementById('daysGrid');
            if (!grid) {
                console.error('daysGrid element not found!');
                return;
            }
            
            grid.innerHTML = '';

            var daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            var firstDay = new Date(currentYear, currentMonth, 1).getDay();
            var today = new Date();

            // Empty days
            for (var i = 0; i < firstDay; i++) {
                var emptyDay = document.createElement('div');
                emptyDay.className = 'day empty-day';
                grid.appendChild(emptyDay);
            }

            // Days
            for (var day = 1; day <= daysInMonth; day++) {
                var dayEl = document.createElement('div');
                dayEl.className = 'day';
                
                var amount = getDayTotal(day);
                var isToday = (today.getDate() === day && 
                              today.getMonth() === currentMonth && 
                              today.getFullYear() === currentYear);

                if (isToday) dayEl.className += ' today';
                if (amount > 0) dayEl.className += ' has-spending';

                var content = '<div class="day-number">' + day + '</div>';
                if (amount > 0) {
                    content += '<div class="day-amount">£' + amount.toFixed(2) + '</div>';
                } else {
                    content += '<div class="plus-icon">+</div>';
                }
                
                dayEl.innerHTML = content;
                
                // Add click handler
                (function(d) {
                    dayEl.onclick = function() { 
                        console.log('Day clicked:', d);
                        openModal(d); 
                    };
                })(day);
                
                grid.appendChild(dayEl);
            }
            
            console.log('Calendar built with', daysInMonth, 'days');
        }

        // Open modal
        function openModal(day) {
            console.log('Opening modal for day:', day);
            selectedDay = day;
            
            var modal = document.getElementById('modal');
            var modalDate = document.getElementById('modalDate');
            var currentTotal = document.getElementById('currentTotal');
            var amountInput = document.getElementById('amountInput');
            var notesInput = document.getElementById('notesInput');
            
            if (!modal || !modalDate || !currentTotal) {
                console.error('Modal elements not found!');
                return;
            }
            
            modalDate.textContent = months[currentMonth] + ' ' + day;
            currentTotal.textContent = 'Total: £' + getDayTotal(day).toFixed(2);
            amountInput.value = '';
            notesInput.value = '';
            
            modal.classList.add('show');
            
            setTimeout(function() {
                if (amountInput) amountInput.focus();
            }, 100);
        }

        // Close modal
        function closeModal() {
            console.log('Closing modal');
            var modal = document.getElementById('modal');
            if (modal) {
                modal.classList.remove('show');
            }
            selectedDay = null;
        }

        // Add spending
        function addSpending() {
            console.log('Adding spending...');
            try {
                var amountInput = document.getElementById('amountInput');
                var notesInput = document.getElementById('notesInput');
                
                if (!amountInput || !notesInput) {
                    console.error('Input elements not found!');
                    return;
                }
                
                var amount = parseFloat(amountInput.value);
                var notes = notesInput.value.trim();
                
                console.log('Amount:', amount, 'Notes:', notes, 'Day:', selectedDay);
                
                if (isNaN(amount) || amount === 0 || !selectedDay) {
                    console.log('Invalid input');
                    return;
                }

                var dateKey = getDateKey(selectedDay);
                var existing = getDayTotal(selectedDay);
                var newTotal = existing + amount;
                
                console.log('Saving new total:', newTotal);
                spendingData[dateKey] = newTotal;

                amountInput.value = '';
                notesInput.value = '';

                saveData();
                updateDisplay();
                buildCalendar();
                
                var currentTotal = document.getElementById('currentTotal');
                if (currentTotal) {
                    currentTotal.textContent = 'Total: £' + getDayTotal(selectedDay).toFixed(2);
                }
                
                console.log('Spending added successfully');
                
            } catch (error) {
                console.error('Error adding spending:', error);
                alert('Error adding spending. Please try again.');
            }
        }

        // Navigate months
        function navigateMonth(direction) {
            console.log('Navigating month:', direction);
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateDisplay();
            buildCalendar();
        }

        // Initialize app
        function initApp() {
            console.log('Initializing app...');
            
            // Load data
            loadData();
            
            // Update display
            updateDisplay();
            
            // Build calendar
            buildCalendar();
            
            // Set up event listeners
            var prevBtn = document.getElementById('prevBtn');
            var nextBtn = document.getElementById('nextBtn');
            var addBtn = document.getElementById('addBtn');
            var cancelBtn = document.getElementById('cancelBtn');
            var modal = document.getElementById('modal');
            var amountInput = document.getElementById('amountInput');
            var notesInput = document.getElementById('notesInput');
            
            if (prevBtn) {
                prevBtn.onclick = function() { navigateMonth(-1); };
                console.log('Prev button connected');
            }
            
            if (nextBtn) {
                nextBtn.onclick = function() { navigateMonth(1); };
                console.log('Next button connected');
            }
            
            if (addBtn) {
                addBtn.onclick = addSpending;
                console.log('Add button connected');
            }
            
            if (cancelBtn) {
                cancelBtn.onclick = closeModal;
                console.log('Cancel button connected');
            }
            
            if (modal) {
                modal.onclick = function(e) {
                    if (e.target.id === 'modal') closeModal();
                };
                console.log('Modal click outside connected');
            }
            
            if (amountInput) {
                amountInput.onkeypress = function(e) {
                    if (e.key === 'Enter') {
                        if (notesInput) notesInput.focus();
                    }
                };
                console.log('Amount input Enter connected');
            }
            
            if (notesInput) {
                notesInput.onkeypress = function(e) {
                    if (e.key === 'Enter') addSpending();
                };
                console.log('Notes input Enter connected');
            }
            
            console.log('App initialized successfully!');
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        console.log('Script loaded');
    </script>
</body>
</html>
