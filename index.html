import React, { useState } from 'react';

import { ChevronLeft, ChevronRight, DollarSign, Plus } from 'lucide-react';



const SpendingCalendar = () => {

  const [currentDate, setCurrentDate] = useState(new Date());

  const [spending, setSpending] = useState({});

  const [selectedDay, setSelectedDay] = useState(null);

  const [inputAmount, setInputAmount] = useState('');



  const months = [

    'January', 'February', 'March', 'April', 'May', 'June',

    'July', 'August', 'September', 'October', 'November', 'December'

  ];



  const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];



  const getDaysInMonth = (date) => {

    return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();

  };



  const getFirstDayOfMonth = (date) => {

    return new Date(date.getFullYear(), date.getMonth(), 1).getDay();

  };



  const generateCalendarDays = () => {

    const daysInMonth = getDaysInMonth(currentDate);

    const firstDay = getFirstDayOfMonth(currentDate);

    const days = [];



    // Empty cells for days before the month starts

    for (let i = 0; i < firstDay; i++) {

      days.push(null);

    }



    // Days of the month

    for (let day = 1; day <= daysInMonth; day++) {

      days.push(day);

    }



    return days;

  };



  const getDateKey = (day) => {

    return `${currentDate.getFullYear()}-${currentDate.getMonth()}-${day}`;

  };



  const handleDayClick = (day) => {

    if (!day) return;

    setSelectedDay(day);

    const dateKey = getDateKey(day);

    setInputAmount(spending[dateKey] || '');

  };



  const handleSaveSpending = () => {

    if (selectedDay && inputAmount !== '') {

      const dateKey = getDateKey(selectedDay);

      const amount = parseFloat(inputAmount);

      if (!isNaN(amount)) {

        setSpending(prev => ({

          ...prev,

          [dateKey]: amount

        }));

      }

    }

    setSelectedDay(null);

    setInputAmount('');

  };



  const handleDeleteSpending = () => {

    if (selectedDay) {

      const dateKey = getDateKey(selectedDay);

      setSpending(prev => {

        const newSpending = { ...prev };

        delete newSpending[dateKey];

        return newSpending;

      });

    }

    setSelectedDay(null);

    setInputAmount('');

  };



  const navigateMonth = (direction) => {

    setCurrentDate(prev => {

      const newDate = new Date(prev);

      newDate.setMonth(prev.getMonth() + direction);

      return newDate;

    });

    setSelectedDay(null);

  };



  const getMonthTotal = () => {

    return Object.entries(spending)

      .filter(([key]) => {

        const [year, month] = key.split('-');

        return parseInt(year) === currentDate.getFullYear() && 

               parseInt(month) === currentDate.getMonth();

      })

      .reduce((sum, [, amount]) => sum + amount, 0);

  };



  const days = generateCalendarDays();



  return (

    <div className="max-w-4xl mx-auto p-6 bg-gray-900 min-h-screen">

      <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 shadow-xl border border-gray-700">

        {/* Header */}

        <div className="flex items-center justify-between mb-8">

          <div className="flex items-center gap-3">

            <DollarSign className="text-green-400" size={32} />

            <h1 className="text-3xl font-bold text-gray-100">Spending Calendar</h1>

          </div>

          <div className="bg-green-900 px-4 py-2 rounded-lg border border-green-700">

            <span className="text-green-200 font-semibold">

              Month Total: £{getMonthTotal().toFixed(2)}

            </span>

          </div>

        </div>



        {/* Month Navigation */}

        <div className="flex items-center justify-between mb-6">

          <button

            onClick={() => navigateMonth(-1)}

            className="flex items-center gap-2 px-4 py-2 bg-gray-700 text-gray-200 rounded-lg shadow hover:bg-gray-600 transition-all border border-gray-600"

          >

            <ChevronLeft size={20} />

            Previous

          </button>

          

          <h2 className="text-2xl font-bold text-gray-100">

            {months[currentDate.getMonth()]} {currentDate.getFullYear()}

          </h2>

          

          <button

            onClick={() => navigateMonth(1)}

            className="flex items-center gap-2 px-4 py-2 bg-gray-700 text-gray-200 rounded-lg shadow hover:bg-gray-600 transition-all border border-gray-600"

          >

            Next

            <ChevronRight size={20} />

          </button>

        </div>



        {/* Calendar Grid */}

        <div className="bg-gray-800 rounded-xl shadow-xl p-6 border border-gray-700">

          {/* Day Headers */}

          <div className="grid grid-cols-7 gap-2 mb-4">

            {daysOfWeek.map(day => (

              <div key={day} className="text-center font-semibold text-gray-300 py-2">

                {day}

              </div>

            ))}

          </div>



          {/* Calendar Days */}

          <div className="grid grid-cols-7 gap-2">

            {days.map((day, index) => {

              if (!day) {

                return <div key={index} className="aspect-square"></div>;

              }



              const dateKey = getDateKey(day);

              const daySpending = spending[dateKey];

              const isToday = new Date().toDateString() === new Date(currentDate.getFullYear(), currentDate.getMonth(), day).toDateString();



              return (

                <button

                  key={day}

                  onClick={() => handleDayClick(day)}

                  className={`aspect-square p-2 rounded-lg border-2 transition-all hover:shadow-lg ${

                    isToday

                      ? 'border-blue-400 bg-blue-900/50 text-blue-200'

                      : daySpending

                      ? 'border-green-400 bg-green-900/50 text-green-200 hover:bg-green-800/50'

                      : 'border-gray-600 bg-gray-700 text-gray-300 hover:bg-gray-600 hover:border-gray-500'

                  }`}

                >

                  <div className="h-full flex flex-col justify-between">

                    <span className={`text-sm font-medium ${isToday ? 'text-blue-200' : daySpending ? 'text-green-200' : 'text-gray-300'}`}>

                      {day}

                    </span>

                    {daySpending ? (

                      <span className="text-xs text-green-300 font-semibold">

                        £{daySpending.toFixed(2)}

                      </span>

                    ) : (

                      <Plus size={12} className="text-gray-500 mx-auto" />

                    )}

                  </div>

                </button>

              );

            })}

          </div>

        </div>



        {/* Input Modal */}

        {selectedDay && (

          <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">

            <div className="bg-gray-800 rounded-xl p-6 w-96 shadow-2xl border border-gray-700">

              <h3 className="text-xl font-bold text-gray-100 mb-4">

                Add Spending for {months[currentDate.getMonth()]} {selectedDay}

              </h3>

              

              <div className="mb-4">

                <label className="block text-gray-300 font-medium mb-2">

                  Amount Spent (£)

                </label>

                <input

                  type="number"

                  step="0.01"

                  value={inputAmount}

                  onChange={(e) => setInputAmount(e.target.value)}

                  placeholder="0.00"

                  className="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-gray-400"

                  autoFocus

                />

              </div>



              <div className="flex gap-3">

                <button

                  onClick={handleSaveSpending}

                  className="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors"

                >

                  Save

                </button>

                {spending[getDateKey(selectedDay)] && (

                  <button

                    onClick={handleDeleteSpending}

                    className="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors"

                  >

                    Delete

                  </button>

                )}

                <button

                  onClick={() => setSelectedDay(null)}

                  className="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors"

                >

                  Cancel

                </button>

              </div>

            </div>

          </div>

        )}

      </div>

    </div>

  );

};



export default SpendingCalendar;

        
