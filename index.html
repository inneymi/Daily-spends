<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Spends</title>
    <link rel="manifest" href="manifest.json">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#059669">
<link rel="apple-touch-icon" href="/icon-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Daily Spends">
<style>
    <style>
        /* Reset and Base Styles */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #111827; 
            color: #f9fafb; 
            min-height: 100vh; 
            padding: 16px; 
        }

        /* Container */
        .container { 
            max-width: 320px; 
            margin: 0 auto; 
            background: #1f2937; 
            border-radius: 16px; 
            padding: 16px; 
        }

        /* Header */
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 0px; 
        }
        
        .title { 
            font-size: 14px; 
            font-weight: bold; 
        }
        
        .subtitle { 
            color: #9ca3af; 
            font-size: 9px; 
            text-align: left; 
            margin-bottom: 10px; 
        }
        
        .total { 
            background: #059669; 
            color: white; 
            padding: 6px 10px; 
            border-radius: 6px; 
            font-size: 11px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: background-color 0.2s; 
            border: none; 
        }
        
        .total:hover { 
            background: #047857; 
        }

        /* Navigation */
        .nav { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-bottom: 12px; 
            gap: 2px; 
        }
        
        .nav-btn { 
            background: #374151; 
            border: none; 
            color: #d1d5db; 
            padding: 6px 10px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 11px; 
            transition: background-color 0.2s; 
        }
        
        .nav-btn:hover { 
            background: #4b5563; 
        }
        
        .month-title { 
            font-size: 14px; 
            font-weight: bold; 
            flex: 1; 
            text-align: center; 
        }

        /* Calendar */
        .calendar { 
            background: #374151; 
            border-radius: 12px; 
            padding: 12px; 
        }
        
        .weekdays { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 3px; 
            margin-bottom: 6px; 
        }
        
        .weekday { 
            text-align: center; 
            font-size: 8px; 
            color: #9ca3af; 
            padding: 4px 0; 
        }
        
        .days { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 3px; 
            min-height: 180px; 
        }

        /* Day Cells */
        .day { 
            aspect-ratio: 1; 
            border: 1px solid #4b5563; 
            background: #4b5563; 
            border-radius: 6px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            cursor: pointer; 
            min-height: 30px; 
            transition: all 0.2s; 
        }
        
        .day:hover { 
            background: #6b7280; 
            transform: scale(1.05); 
        }
        
        .day.today { 
            border-color: #3b82f6; 
            background: rgba(59, 130, 246, 0.3); 
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);
        }
        
        .day.has-spending { 
            border-color: #10b981; 
            background: rgba(16, 185, 129, 0.2); 
        }
        
        .day.selected-day { 
            border-color: #f59e0b; 
            background: rgba(245, 158, 11, 0.2); 
        }
        
        .day-number { 
            font-weight: 600; 
            font-size: 10px; 
            color: #f9fafb; 
        }
        
        .day-amount { 
            font-size: 8px; 
            color: #34d399; 
            margin-top: 0.5px; 
            font-weight: normal; 
        }
        
        .plus-icon { 
            font-size: 8px; 
            color: #6b7280; 
            margin-top: 0.5px; 
        }
        
        .empty-day { 
            border: none; 
            background: none; 
            cursor: default; 
        }
        
        .empty-day:hover { 
            transform: none; 
        }

        /* Footer */
        .footer { 
            margin-top: 16px; 
            padding: 12px 0; 
            border-top: 1px solid #374151; 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
        }
        
        .footer-link { 
            background: none; 
            border: none; 
            color: #9ca3af; 
            font-size: 12px; 
            cursor: pointer; 
            padding: 8px 12px; 
            border-radius: 6px; 
            transition: all 0.2s; 
        }
        
        .footer-link:hover { 
            color: #d1d5db; 
            background: #374151; 
        }

        /* Modal */
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0, 0, 0, 0.9); 
            display: none; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
            overflow-y: auto;
            z-index: 1000; 
        }
        
        .modal.show { 
            display: flex; 
        }
        
        .modal-content { 
            background: #1f2937; 
            border-radius: 16px; 
            padding: 20px; 
            width: 100%; 
            max-width: 280px;
            margin: auto;
            position: relative;
        }
        
        .modal-header { 
            text-align: center; 
            margin-bottom: 12px; 
        }
        
        .modal-date { 
            font-size: 16px; 
            font-weight: normal; 
            color: #f9fafb; 
            margin-bottom: 6px; 
        }
        
        .modal-total { 
            background: #059669; 
            color: white; 
            padding: 6px 12px; 
            border-radius: 6px; 
            font-size: 11px; 
            font-weight: bold; 
            display: inline-block; 
        }

        /* Form Inputs */
        .amount-input { 
            width: 100%; 
            padding: 12px; 
            background: #374151; 
            border: 2px solid #4b5563; 
            border-radius: 8px; 
            color: #f9fafb; 
            font-size: 14px; 
            text-align: center; 
            outline: none; 
            margin-bottom: 8px; 
            transition: border-color 0.2s; 
            box-sizing: border-box;
        }
        
        .amount-input:focus { 
            border-color: #3b82f6; 
        }
        
        .amount-input::placeholder { 
            color: #9ca3af; 
            font-size: 13px; 
        }
        
        .amount-input::-webkit-outer-spin-button, 
        .amount-input::-webkit-inner-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        
        .amount-input[type=number] { 
            -moz-appearance: textfield; 
        }
        
        .notes-input { 
            width: 100%; 
            padding: 10px; 
            background: #374151; 
            border: 2px solid #4b5563; 
            border-radius: 8px; 
            color: #f9fafb; 
            font-size: 13px; 
            outline: none; 
            margin-bottom: 12px; 
            text-align: left; 
            transition: border-color 0.2s; 
        }
        
        .notes-input:focus { 
            border-color: #3b82f6; 
        }
        
        .notes-input::placeholder { 
            color: #9ca3af; 
            font-size: 13px; 
        }

        /* Transaction Summary */
        .transaction-summary { 
            background: #374151; 
            border-radius: 8px; 
            padding: 8px 12px; 
            margin: 12px 0; 
            font-size: 11px; 
            color: #d1d5db; 
            border: 1px solid #4b5563; 
            text-align: center; 
            cursor: pointer; 
            transition: background-color 0.2s; 
        }
        
        .transaction-summary:hover { 
            background: #4b5563; 
        }

        /* Modal Buttons */
        .modal-buttons { 
            display: flex; 
            gap: 8px; 
            margin-top: 16px; 
        }
        
        .modal-btn { 
            flex: 1; 
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            font-weight: normal; 
            cursor: pointer; 
            font-size: 14px; 
            transition: all 0.2s; 
        }
        
        .btn-add { 
            background: #3b82f6; 
            color: white; 
        }
        
        .btn-add:hover { 
            background: #2563eb; 
        }
        
        .btn-close { 
            background: #6b7280; 
            color: white; 
        }
        
        .btn-close:hover { 
            background: #4b5563; 
        }

        /* Error Message */
        .error-message { 
            color: #f87171; 
            font-size: 12px; 
            margin-top: 4px; 
            text-align: center; 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">Daily Spends</div>
            <button class="total" id="monthTotal">Total: £0.00</button>
        </div>
        
        <div class="subtitle">Click any day to track spending</div>
        
        <div class="nav">
            <button class="nav-btn" id="prevBtn">‹ Prev</button>
            <div class="month-title" id="monthTitle">September 2025</div>
            <button class="nav-btn" id="nextBtn">Next ›</button>
        </div>
        
        <div class="calendar">
            <div class="weekdays">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>
            <div class="days" id="daysGrid"></div>
        </div>
        
        <div class="footer">
            <button class="footer-link" id="helpBtn">Help</button>
        </div>
    </div>

    <!-- Day Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-date" id="modalDate" style="font-size: 14px; font-weight: bold;">September 17</div>
                <div class="modal-total" id="modalTotal">Total: £0.00</div>
            </div>
            
            <input type="number" step="0.01" class="amount-input" id="amountInput" placeholder="Amount to add (£)" min="0" max="99999.99">
            <div id="amountError" class="error-message"></div>
            
            <input type="text" class="notes-input" id="notesInput" placeholder="Notes (optional)" maxlength="100">
            
            <div id="transactionSummary" class="transaction-summary">
                <div id="summaryText">No transactions yet</div>
                <div id="summaryHint" style="display: none; color: #9ca3af; font-size: 10px; margin-top: 2px;">Tap to view details</div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn btn-add" id="addBtn">Add</button>
                <button class="modal-btn btn-close" id="closeBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let spendingData = {};
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDay = null;
        const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

        // Data functions
        function loadData() {
    try {
        const saved = localStorage.getItem('spendingData');
        if (saved) {
            spendingData = JSON.parse(saved);
        } else {
            spendingData = {};
        }
    } catch (e) {
        spendingData = {};
    }
    addSampleData();
}

        function saveData() {
    try {
        localStorage.setItem('spendingData', JSON.stringify(spendingData));
    } catch (e) {
        console.warn('Could not save data');
    }
}

        function addSampleData() {
        // No sample data - users start with blank calendar
        }

        function getDateKey(day) {
            return currentYear + '-' + currentMonth + '-' + day;
        }

        function getDayTotal(day) {
            const data = spendingData[getDateKey(day)];
            if (!data || !data.transactions) return 0;
            return data.transactions.reduce((sum, t) => sum + (t.amount || 0), 0);
        }

        function getDayTransactions(day) {
            const data = spendingData[getDateKey(day)];
            return (data && data.transactions) ? data.transactions : [];
        }

        function getMonthTotal() {
            let total = 0;
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                total += getDayTotal(day);
            }
            return total;
        }

        // Display functions
        function buildCalendar() {
            const grid = document.getElementById('daysGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const today = new Date();

            // Empty cells
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty-day';
                grid.appendChild(emptyDay);
            }

            // Day cells
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('button');
                dayEl.className = 'day';
                
                const amount = getDayTotal(day);
                const isToday = (today.getDate() === day && today.getMonth() === currentMonth && today.getFullYear() === currentYear);

                if (isToday) dayEl.className += ' today';
                if (amount > 0) dayEl.className += ' has-spending';
                if (selectedDay === day) dayEl.className += ' selected-day';

                let content = `<div class="day-number">${day}</div>`;
                if (amount > 0) {
                    content += `<div class="day-amount">£${amount.toFixed(2)}</div>`;
                } else {
                    content += '<div class="plus-icon">+</div>';
                }
                
                dayEl.innerHTML = content;
                dayEl.onclick = () => openModal(day);
                grid.appendChild(dayEl);
            }
        }

        function updateDisplay() {
            document.getElementById('monthTitle').textContent = months[currentMonth] + ' ' + currentYear;
            const total = getMonthTotal();
            document.getElementById('monthTotal').textContent = 'Total: £' + total.toFixed(2);
        }

        function updateTransactionSummary() {
            const transactions = getDayTransactions(selectedDay);
            const summaryText = document.getElementById('summaryText');
            const summaryHint = document.getElementById('summaryHint');
            const summary = document.getElementById('transactionSummary');
            
            if (transactions.length === 0) {
                summaryText.textContent = 'No transactions yet';
                summaryHint.style.display = 'none';
                summary.onclick = null;
            } else {
                const withNotes = transactions.filter(t => t.notes && t.notes.trim()).length;
                if (transactions.length === 1) {
                    summaryText.innerHTML = '<span style="color: #34d399; font-weight: 600;">1 transaction</span>' + (withNotes > 0 ? ' with notes' : '');
                } else {
                    summaryText.innerHTML = '<span style="color: #34d399; font-weight: 600;">' + transactions.length + ' transactions</span>' + (withNotes > 0 ? ' (' + withNotes + ' with notes)' : '');
                }
                summaryHint.style.display = 'block';
                summary.onclick = () => openTransactionDetails();
            }
        }

        function openTransactionDetails() {
            if (!selectedDay || getDayTransactions(selectedDay).length === 0) return;
            
            document.getElementById('modal').classList.remove('show');
            
            const transactions = getDayTransactions(selectedDay);
            
            let detailsHtml = `
                <div onclick="if(event.target === this) closeTransactionDetails()" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; padding: 20px; z-index: 1001;">
                    <div style="background: #1f2937; border-radius: 16px; padding: 20px; width: 100%; max-width: 300px;">
                        <div style="text-align: center; margin-bottom: 16px;">
                            <div style="font-size: 14px; font-weight: bold; color: #f9fafb; margin-bottom: 4px;">${months[currentMonth]} ${selectedDay}</div>
                            <div style="background: #059669; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; display: inline-block;">Total: £${getDayTotal(selectedDay).toFixed(2)}</div>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <div style="font-size: 14px; font-weight: bold; color: #f9fafb; margin-bottom: 12px;">Transactions</div>
                        </div>
                        <div style="max-height: 300px; overflow-y: auto; margin-bottom: 16px;">`;
            
            transactions.forEach((transaction) => {
                const timeDisplay = transaction.time || '--:--';
                
                detailsHtml += `
                    <div style="background: #374151; border-radius: 8px; padding: 12px; margin-bottom: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px;">
                            <div style="color: #34d399; font-weight: bold; font-size: 10px;">£${transaction.amount.toFixed(2)}</div>
                            <div style="font-size: 11px; color: #9ca3af;">${timeDisplay}</div>
                        </div>
                        ${transaction.notes ? `<div style="font-size: 10px; color: #d1d5db; margin-bottom: 6px; font-style: italic;">${transaction.notes}</div>` : ''}
                        <div style="display: flex; gap: 6px;">
                            <button onclick="event.stopPropagation(); editTransaction('${transaction.id}')" style="background: #3b82f6; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 11px; cursor: pointer;">Edit</button>
                            <button onclick="event.stopPropagation(); deleteTransaction('${transaction.id}')" style="background: #6b7280; color: white; border: none; border-radius: 4px; padding: 6px 12px; font-size: 11px; cursor: pointer;">Delete</button>
                        </div>
                    </div>`;
            });
            
            detailsHtml += `
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="closeTransactionDetails()" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: normal; cursor: pointer; font-size: 14px; background: #6b7280; color: white;">Close</button>
                        </div>
                    </div>
                </div>`;
            
            const detailsModal = document.createElement('div');
            detailsModal.id = 'transactionDetailsModal';
            detailsModal.innerHTML = detailsHtml;
            document.body.appendChild(detailsModal);
        }

        function closeTransactionDetails() {
            const modal = document.getElementById('transactionDetailsModal');
            if (modal) modal.remove();
        }

        function deleteTransaction(transactionId) {
            if (!confirm('Delete this transaction?')) return;
            
            const dateKey = getDateKey(selectedDay);
            const data = spendingData[dateKey];
            
            if (data && data.transactions) {
                data.transactions = data.transactions.filter(t => t.id !== transactionId);
                
                if (data.transactions.length === 0) {
                    delete spendingData[dateKey];
                }
                
                saveData();
                updateDisplay();
                buildCalendar();
                closeTransactionDetails();
                openModal(selectedDay);
            }
        }

        function editTransaction(transactionId) {
            const dateKey = getDateKey(selectedDay);
            const data = spendingData[dateKey];
            
            if (data && data.transactions) {
                const transaction = data.transactions.find(t => t.id === transactionId);
                if (transaction) {
                    closeTransactionDetails();
                    openModal(selectedDay);
                    
                    document.getElementById('amountInput').value = transaction.amount;
                    document.getElementById('notesInput').value = transaction.notes || '';
                    
                    const addBtn = document.getElementById('addBtn');
                    addBtn.textContent = 'Update';
                    
                    addBtn.onclick = function() {
                        const amount = parseFloat(document.getElementById('amountInput').value);
                        const notes = document.getElementById('notesInput').value.trim();
                        
                        if (isNaN(amount) || amount <= 0) {
                            showError('Please enter a valid amount');
                            return;
                        }
                        
                        data.transactions = data.transactions.filter(t => t.id !== transactionId);
                        data.transactions.push({
                            id: 'tx-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                            amount: amount,
                            notes: notes.substring(0, 100) || '',
                            time: transaction.time
                        });
                        
                        saveData();
                        updateDisplay();
                        buildCalendar();
                        
                        document.getElementById('amountInput').value = '';
                        document.getElementById('notesInput').value = '';
                        addBtn.textContent = 'Add';
                        addBtn.onclick = addSpending;
                        
                        const dayTotal = getDayTotal(selectedDay);
                        document.getElementById('modalTotal').textContent = 'Total: £' + dayTotal.toFixed(2);
                        updateTransactionSummary();
                        
                        setTimeout(() => document.getElementById('amountInput').focus(), 100);
                    };
                }
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('amountError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => errorEl.style.display = 'none', 3000);
        }

        function showHelp() {
            let helpHtml = `
                <div id="helpModalBackdrop" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; padding: 20px; z-index: 1001;">
                    <div id="helpModalContent" style="background: #1f2937; border-radius: 16px; padding: 20px; width: 100%; max-width: 350px; max-height: 80vh; overflow-y: auto;">
                        <div style="text-align: center; margin-bottom: 16px;">
                            <div style="font-size: 16px; font-weight: bold; color: #f9fafb;">Daily Spends Help</div>
                        </div>
                        <div style="text-align: left; margin-bottom: 16px; line-height: 1.4; font-size: 12px; color: #d1d5db;">
                            <div style="margin-bottom: 16px;">
                                <div style="color: #34d399; font-weight: bold; margin-bottom: 6px;">Managing Expenses</div>
                                <div>• Select a day and enter your spend<br>• Add optional notes (coffee, taxi, teabags, etc)<br>• Tap Add to save<br>• Add, edit, and delete entries anytime<br>• Take a monthly screenshot for backup needs</div>
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <div style="color: #34d399; font-weight: bold; margin-bottom: 6px;">Viewing Your Data</div>
                                <div>• Tap monthly total at top to view all monthly<br>&nbsp;&nbsp;&nbsp;transactions<br>• Each day shows total spending<br>• Tap transaction summaries to view details</div>
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <div style="color: #34d399; font-weight: bold; margin-bottom: 6px;">Currency</div>
                                <div>All amounts are in British Pounds (£). For currencies and conversions, visit <a href="https://xe.com" target="_blank" style="color: #60a5fa; text-decoration: underline;">xe.com</a>.</div>
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <div style="color: #34d399; font-weight: bold; margin-bottom: 6px;">Data Storage</div>
                                <div>Your spending data is automatically saved in your browser. It stays private on your device.</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="closeHelp()" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: normal; cursor: pointer; font-size: 14px; background: #6b7280; color: white;">Got it!</button>
                        </div>
                    </div>
                </div>`;
            
            const helpModal = document.createElement('div');
            helpModal.id = 'helpModal';
            helpModal.innerHTML = helpHtml;
            document.body.appendChild(helpModal);
            
            const backdrop = document.getElementById('helpModalBackdrop');
            const content = document.getElementById('helpModalContent');
            
            backdrop.addEventListener('click', function(e) {
                if (!content.contains(e.target)) {
                    closeHelp();
                }
            });
        }

        function closeHelp() {
            const modal = document.getElementById('helpModal');
            if (modal) modal.remove();
        }

        function navigateMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateDisplay();
            buildCalendar();
        }

        function openModal(day) {
            selectedDay = day;
            document.getElementById('modalDate').textContent = months[currentMonth] + ' ' + day;
            
            const dayTotal = getDayTotal(day);
            document.getElementById('modalTotal').textContent = 'Total: £' + dayTotal.toFixed(2);
            document.getElementById('amountInput').value = '';
            document.getElementById('notesInput').value = '';
            document.getElementById('amountError').style.display = 'none';
            updateTransactionSummary();
            document.getElementById('modal').classList.add('show');
            
            buildCalendar();
            
            setTimeout(() => document.getElementById('amountInput').focus(), 100);
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
            selectedDay = null;
            buildCalendar();
        }

        function addSpending() {
            const amountInput = document.getElementById('amountInput');
            const amount = parseFloat(amountInput.value);
            const notes = document.getElementById('notesInput').value.trim();
            
            document.getElementById('amountError').style.display = 'none';
            
            if (isNaN(amount) || amount <= 0) {
                showError('Please enter a valid amount greater than 0');
                amountInput.focus();
                return;
            }
            
            if (amount > 99999.99) {
                showError('Amount cannot exceed £99,999.99');
                amountInput.focus();
                return;
            }

            const dateKey = getDateKey(selectedDay);
            const existingData = spendingData[dateKey];
            const transactions = (existingData && existingData.transactions) ? existingData.transactions.slice() : [];
            
            transactions.push({
                id: 'tx-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                amount: amount,
                notes: notes.substring(0, 100) || '',
                time: new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })
            });
            
            spendingData[dateKey] = { transactions: transactions };
            
            document.getElementById('amountInput').value = '';
            document.getElementById('notesInput').value = '';
            
            const dayTotal = getDayTotal(selectedDay);
            document.getElementById('modalTotal').textContent = 'Total: £' + dayTotal.toFixed(2);
            
            saveData();
            updateDisplay();
            buildCalendar();
            updateTransactionSummary();
            
            setTimeout(() => document.getElementById('amountInput').focus(), 100);
        }

        function openMonthlyOverview() {
            const total = getMonthTotal();
            let monthlyHtml = `
                <div onclick="if(event.target === this) closeMonthlyOverview()" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; padding: 20px; z-index: 1001;">
                    <div style="background: #1f2937; border-radius: 16px; padding: 20px; width: 100%; max-width: 300px;">
                        <div style="text-align: center; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: center; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <button onclick="navigateMonthlyOverview(-1)" style="background: #374151; border: none; color: #d1d5db; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">‹</button>
                                <div style="font-size: 14px; font-weight: bold; color: #f9fafb;">${months[currentMonth]} ${currentYear} Overview</div>
                                <button onclick="navigateMonthlyOverview(1)" style="background: #374151; border: none; color: #d1d5db; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">›</button>
                            </div>
                            <div style="background: #059669; color: white; padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; display: inline-block;">Total: £${total.toFixed(2)}</div>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 16px;">`;
            
            const allTransactions = [];
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const transactions = getDayTransactions(day);
                transactions.forEach(transaction => {
                    allTransactions.push({ day, transaction });
                });
            }
            
            if (allTransactions.length === 0) {
                monthlyHtml += '<div style="text-align: center; color: #9ca3af; padding: 40px 20px; font-size: 12px;">No transactions this month</div>';
            } else {
                allTransactions.sort((a, b) => a.day - b.day);
                
                let currentDay = null;
                allTransactions.forEach(item => {
                    const date = new Date(currentYear, currentMonth, item.day);
                    const dayName = date.toLocaleDateString('en-GB', { weekday: 'short' });
                    
                    if (currentDay !== item.day) {
                        currentDay = item.day;
                        monthlyHtml += `<div style="color: #d1d5db; font-size: 12px; font-weight: bold; margin: 12px 0 8px 0; text-align: left;">${dayName} ${item.day}</div>`;
                    }
                    
                    monthlyHtml += `
                        <div style="background: #374151; border-radius: 8px; padding: 12px; margin-bottom: 6px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px;">
                                <div style="color: #34d399; font-weight: bold; font-size: 10px;">£${item.transaction.amount.toFixed(2)}</div>
                                <div style="font-size: 11px; color: #9ca3af;">${item.transaction.time || '--:--'}</div>
                            </div>
                            ${item.transaction.notes ? `<div style="font-size: 10px; color: #d1d5db; font-style: italic;">${item.transaction.notes}</div>` : ''}
                        </div>`;
                });
            }
            
            monthlyHtml += `
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="closeMonthlyOverview()" style="flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: normal; cursor: pointer; font-size: 14px; background: #6b7280; color: white;">Close</button>
                        </div>
                    </div>
                </div>`;
            
            const monthlyModal = document.createElement('div');
            monthlyModal.id = 'monthlyOverviewModal';
            monthlyModal.innerHTML = monthlyHtml;
            document.body.appendChild(monthlyModal);
        }

        function closeMonthlyOverview() {
            const modal = document.getElementById('monthlyOverviewModal');
            if (modal) modal.remove();
        }

        function navigateMonthlyOverview(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            
            updateDisplay();
            buildCalendar();
            closeMonthlyOverview();
            openMonthlyOverview();
        }

        function setupEventListeners() {
            document.getElementById('prevBtn').onclick = () => navigateMonth(-1);
            document.getElementById('nextBtn').onclick = () => navigateMonth(1);
            document.getElementById('addBtn').onclick = addSpending;
            document.getElementById('closeBtn').onclick = closeModal;
            document.getElementById('helpBtn').onclick = showHelp;
            document.getElementById('monthTotal').onclick = () => openMonthlyOverview();
            
            document.getElementById('modal').onclick = function(e) {
                if (e.target === this) closeModal();
            };
            
            document.getElementById('amountInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addSpending();
                }
            });
            
            document.getElementById('notesInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addSpending();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    closeTransactionDetails();
                    closeHelp();
                }
            });
        }

        function init() {
            loadData();
            updateDisplay();
            buildCalendar();
            setupEventListeners();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
    <script>
// Register Service Worker for PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then((registration) => {
        console.log('Service Worker registered successfully');
      })
      .catch((error) => {
        console.log('Service Worker registration failed:', error);
      });
  });
}
</script>
</body>
</html>
</body>
</html>
